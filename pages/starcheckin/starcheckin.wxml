<view class="container starcheckin-page">
  <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
  <view class="starry-bg"></view>
  
  <!-- åŠ è½½ä¸­ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-icon"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <block wx:if="{{!isLoading}}">
    <!-- æ‰“å¡ä¿¡æ¯æ  -->
    <view class="checkin-info">
      <view class="info-card">
        <view class="info-item">
          <text class="info-label">ç´¯è®¡æ‰“å¡</text>
          <text class="info-value">{{checkinInfo.totalDays}}å¤©</text>
        </view>
        <view class="info-item">
          <text class="info-label">è¿ç»­æ‰“å¡</text>
          <text class="info-value">{{checkinInfo.continuousDays}}å¤©</text>
        </view>
      </view>
      
      <!-- æ‰“å¡æŒ‰é’® -->
      <view class="checkin-btn {{checkinInfo.todayChecked ? 'checked' : ''}}" bindtap="doCheckin">
        <view class="btn-inner">
          <text class="btn-text">{{checkinInfo.todayChecked ? 'ä»Šæ—¥å·²æ‰“å¡' : 'ä»Šæ—¥æ‰“å¡'}}</text>
          <text class="btn-desc" wx:if="{{checkinInfo.todayChecked}}">æ¯æ—¥æ‰“å¡è§£é”æ˜Ÿä½“</text>
          <text class="btn-desc" wx:else>æ¯æ—¥æ‰“å¡è§£é”æ˜Ÿä½“</text>
        </view>
      </view>
      
      <!-- è¿ç»­æ‰“å¡å¥–åŠ±è¯´æ˜ -->
      <view class="reward-info">
        <view class="reward-title">ğŸ è¿ç»­æ‰“å¡å¥–åŠ±</view>
        <view class="reward-list">
          <view class="reward-item">
            <text class="reward-days">10å¤©</text>
            <text class="reward-desc">å¥–åŠ±3å¤©ä¼šå‘˜</text>
          </view>
          <view class="reward-item">
            <text class="reward-days">20å¤©</text>
            <text class="reward-desc">å¥–åŠ±7å¤©ä¼šå‘˜</text>
          </view>
          <view class="reward-item">
            <text class="reward-days">30å¤©</text>
            <text class="reward-desc">å¥–åŠ±15å¤©ä¼šå‘˜</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- æ—¥å†åŒºåŸŸ -->
    <view class="calendar-container">
      <view class="calendar-header">
        <view class="header-left" bindtap="prevMonth">
          <text class="arrow">â†</text>
        </view>
        <view class="header-title">
          <text>{{year}}å¹´{{month}}æœˆ</text>
        </view>
        <view class="header-right" bindtap="nextMonth">
          <text class="arrow">â†’</text>
        </view>
      </view>
      
      <!-- æ˜ŸæœŸæ ‡é¢˜ -->
      <view class="week-header">
        <view class="week-cell" wx:for="{{['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']}}" wx:key="*this">
          <text>{{item}}</text>
        </view>
      </view>
      
      <!-- æ—¥å†ä¸»ä½“ -->
      <view class="calendar-body">
        <block wx:for="{{weeks}}" wx:for-item="week" wx:for-index="weekIdx" wx:key="weekIdx">
          <view class="week-row">
            <block wx:for="{{week}}" wx:for-item="day" wx:key="day">
              <view 
                class="day-cell {{!day.isCurrentMonth ? 'day-other-month' : ''}} {{day.isToday ? 'day-today' : ''}} {{day.hasCheckin ? 'day-has-checkin' : ''}}"
                bindtap="{{day.hasCheckin ? 'tapDayItem' : ''}}"
                data-date="{{day.date}}"
              >
                <view class="day-number">{{day.day}}</view>
                <view class="checkin-icon" wx:if="{{day.hasCheckin}}">
                  <text class="icon-star">â˜…</text>
                </view>
              </view>
            </block>
          </view>
        </block>
      </view>
      
      <!-- æ—¥å†è¯´æ˜ -->
      <view class="calendar-legend">
        <view class="legend-item">
          <view class="legend-icon checked"></view>
          <text class="legend-text">å·²æ‰“å¡</text>
        </view>
        <view class="legend-item">
          <text class="legend-text">ç‚¹å‡»æ‰“å¡æ—¥æœŸæŸ¥çœ‹æ˜Ÿä½“</text>
        </view>
      </view>
    </view>
    
    <!-- æ¯æ—¥æ­£èƒ½é‡ -->
    <view class="daily-quote">
      <text class="quote-title">æ¯æ—¥æ­£èƒ½é‡</text>
      <view class="quote-content">
        <text class="quote-text">{{dailyQuote.content || 'æ¢ç´¢æ˜Ÿç©ºï¼Œå‘ç°æœªçŸ¥çš„å®‡å®™å¥¥ç§˜ï¼Œæ¯ä¸€æ¬¡ä»°æœ›éƒ½æ˜¯å¿ƒçµçš„æ—…è¡Œã€‚'}}</text>
        <text class="quote-author" wx:if="{{dailyQuote.author}}">â€”â€”{{dailyQuote.author}}</text>
      </view>
    </view>
  </block>
  
  <!-- æ˜Ÿä½“è¯¦æƒ…å¼¹çª— -->
  <view class="celestial-modal" wx:if="{{showCelestialDetail}}">
    <view class="modal-mask" bindtap="closeCelestialDetail"></view>
    <view class="modal-content">
      <view class="modal-close" bindtap="closeCelestialDetail">Ã—</view>
      <view class="celestial-header">
        <text class="celestial-name">{{currentCelestial.name}}</text>
        <text class="celestial-type">{{currentCelestial.type === 'planet' ? 'è¡Œæ˜Ÿ' : 
                                      currentCelestial.type === 'star' ? 'æ’æ˜Ÿ' : 
                                      currentCelestial.type === 'galaxy' ? 'æ˜Ÿç³»' : 
                                      currentCelestial.type === 'nebula' ? 'æ˜Ÿäº‘' : 
                                      currentCelestial.type === 'satellite' ? 'å«æ˜Ÿ' : 
                                      currentCelestial.type === 'blackhole' ? 'é»‘æ´' : 
                                      currentCelestial.type === 'constellation' ? 'æ˜Ÿåº§' : 
                                      currentCelestial.type === 'comet' ? 'å½—æ˜Ÿ' : 
                                      currentCelestial.type === 'meteor' ? 'æµæ˜Ÿ' : 
                                      currentCelestial.type === 'cluster' ? 'æ˜Ÿå›¢' : 
                                      currentCelestial.type === 'dwarf' ? 'çŸ®è¡Œæ˜Ÿ' : 
                                      currentCelestial.type === 'deepspace' ? 'æ·±ç©ºå¤©ä½“' : 
                                      currentCelestial.type === 'artificial' ? 'äººé€ å¤©ä½“' : 'å¤©ä½“'}}</text>
      </view>
      <view class="celestial-image-container">
        <image class="celestial-image" src="{{currentCelestial.image}}" mode="aspectFit"></image>
      </view>
      <view class="celestial-info">
        <text class="celestial-description">{{currentCelestial.description}}</text>
        <view class="checkin-timestamp">
          <text>æ‰“å¡æ—¥æœŸ: {{currentCelestial.checkinDate}}</text>
          <text wx:if="{{currentCelestial.checkinTime}}">æ‰“å¡æ—¶é—´: {{currentCelestial.checkinTime}}</text>
        </view>
      </view>
    </view>
  </view>
</view>
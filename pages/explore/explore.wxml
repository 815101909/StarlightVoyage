<!--pages/explore/explore.wxml-->
<view class="container explore-page">
  <!-- é¡¶éƒ¨èƒŒæ™¯æ˜Ÿç©º -->
  <view class="explore-bg"></view>
  
  <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šé¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æ˜Ÿæ²³æ¬²è½¬åƒå¸†èˆ</text>
    <text class="page-subtitle">å®‹ä»£ Â· ææ¸…ç…§ Â· ã€Šæ¸”å®¶å‚²ã€‹</text>
  </view>
  
  <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šæ¢ç´¢ä¸åœæ­‡ -->
  <view class="section explore-section">
    <view class="section-header">
      <text class="section-title">æ¢ç´¢ä¸åœæ­‡</text>
      <view class="date-picker-container">
        <picker mode="date" bindchange="dateChange">
          <view class="date-picker">
            <text class="date-picker-text">{{currentDate}}</text>
            <text class="date-picker-icon">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- åˆ‡æ¢æ ‡ç­¾ -->
    <view class="section-tabs">
      <view class="tab {{currentTab === 'news' ? 'active' : ''}}" bindtap="switchTab" data-tab="news">
        <text class="tab-icon">ğŸ”­</text>
        <text class="tab-text">å¤©æ–‡æ—¶äº‹</text>
      </view>
      <view class="tab {{currentTab === 'review' ? 'active' : ''}}" bindtap="switchTab" data-tab="review">
        <text class="tab-icon">ğŸ“–</text>
        <text class="tab-text">å¤©æ–‡å›é¡¾</text>
      </view>
    </view>
    
    <!-- æ–‡ç« åˆ—è¡¨ -->
    <scroll-view scroll-y class="article-scroll-list" 
                enable-flex show-scrollbar="{{true}}" 
                bindscrolltolower="loadArticles">
      <view class="article-list">
        <block wx:for="{{articles}}" wx:key="id">
          <view class="article-card" bindtap="goToArticleDetail" data-id="{{item.id}}">
            <image class="article-image" 
                   src="{{item.coverUrl}}" 
                   mode="aspectFill"
                   lazy-load="{{true}}"
                   binderror="handleImageError"
                   data-index="{{index}}"></image>
            <view class="article-info">
              <view class="article-title">{{item.title}}</view>
              <view class="article-meta">
                  <text class="article-tag">{{item.category}}</text>
                  <text class="article-date">{{item.date}}</text>
              </view>
            </view>
          </view>
        </block>
        
        <!-- åŠ è½½ä¸­çŠ¶æ€ -->
        <view class="loading-container" wx:if="{{isLoading}}">
          <view class="loading-icon"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>
        
        <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
        <view class="no-more" wx:if="{{!hasMore.article && articles.length > 0}}">
          <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{!isLoading && articles.length === 0}}">
          <text class="empty-icon">ğŸŒŒ</text>
          <text class="empty-text">æš‚æ— ç›¸å…³æ–‡ç« </text>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®‡å®™å°å‰§åœº -->
  <view class="section video-section">
    <view class="section-header">
      <text class="section-title">å®‡å®™å°å‰§åœº</text>
      <view class="date-filter-container">
        <view class="date-filter-btn {{!filterByDate ? 'active' : ''}}" bindtap="resetDateFilter">å…¨éƒ¨</view>
        <picker mode="date" bindchange="videoDateChange">
          <view class="date-picker {{filterByDate ? 'active' : ''}}">
            <text class="date-picker-text">{{currentDate}}</text>
            <text class="date-picker-icon">â–¼</text>
          </view>
        </picker>
      </view>
    </view>
    
    <!-- è§†é¢‘åˆ—è¡¨ -->
    <scroll-view scroll-y class="video-content-scroll" 
                enable-flex show-scrollbar="{{true}}" 
                bindscrolltolower="loadVideos">
      <view class="video-list">
        <block wx:for="{{videoList}}" wx:key="id">
          <view class="video-list-item" bindtap="playVideo" data-video="{{item}}">
            <view class="video-item-container">
              <image class="video-item-cover" src="{{item.coverUrl}}" mode="aspectFill"></image>
              <view class="video-item-overlay">
                <view class="video-item-play-icon">â–¶</view>
                <view class="video-item-duration">{{item.duration || '00:00'}}</view>
              </view>
            </view>
            <view class="video-item-info">
              <view class="video-item-title">{{item.title}}</view>
              <view class="video-item-description" wx:if="{{item.description}}">{{item.description}}</view>
              <view class="video-item-meta">
                <view class="video-meta-left">
                  <text class="video-item-author" wx:if="{{item.author}}">{{item.author}}</text>
                  <text class="video-item-date">{{item.publishTime || item.date}}</text>
                </view>
                <view class="video-meta-right">
                  <text class="video-item-views">{{item.views}}äººè§‚çœ‹</text>
                </view>
              </view>
            </view>
          </view>
        </block>
        
        <!-- åŠ è½½ä¸­çŠ¶æ€ -->
        <view class="loading-container" wx:if="{{isLoading}}">
          <view class="loading-icon"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>
        
        <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
        <view class="no-more" wx:if="{{!hasMore.video && videoList.length > 0}}">
          <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{!isLoading && videoList.length === 0}}">
          <text class="empty-icon">ğŸ¬</text>
          <text class="empty-text">è¿™ä¸€å¤©æ²¡æœ‰è§†é¢‘</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¨ªå±è§†é¢‘æ’­æ”¾æ¨¡æ€æ¡† -->
  <view class="video-modal {{showVideoModal ? 'active' : ''}}" wx:if="{{currentVideo}}">
    <view class="video-modal-mask" bindtap="closeVideoModal"></view>
    <view class="video-modal-content">
      <!-- è§†é¢‘æ’­æ”¾å™¨ -->
      <video 
        id="fullscreen-video"
        class="fullscreen-video"
        src="{{currentVideo.videoUrl}}"
        poster="{{currentVideo.coverUrl}}"
        poster-for-crawler="{{false}}"
        autoplay="{{true}}"
        controls="{{true}}"
        show-fullscreen-btn="{{true}}"
        show-play-btn="{{true}}"
        show-center-play-btn="{{true}}"
        enable-danmu="{{false}}"
        object-fit="contain"
        show-progress="{{true}}"
        initial-time="0"
        bindplay="onVideoPlay"
        bindpause="onVideoPause"
        bindended="onVideoEnded"
        binderror="onVideoError"
        bindtimeupdate="onTimeUpdate"
        bindloadedmetadata="onVideoReady">
      </video>
      
      <!-- è§†é¢‘ä¿¡æ¯æ  -->
      <view class="video-modal-info">
        <view class="video-modal-title">{{currentVideo.title}}</view>
        <view class="video-modal-meta">
          <text class="video-modal-author" wx:if="{{currentVideo.author}}">{{currentVideo.author}}</text>
          <text class="video-modal-views">{{currentVideo.views}}äººè§‚çœ‹</text>
          <text class="video-modal-duration">æ—¶é•¿: {{currentVideo.duration || '00:00'}}</text>
        </view>
        <view class="video-modal-description" wx:if="{{currentVideo.description}}">
          {{currentVideo.description}}
        </view>
      </view>
      
      <!-- å…³é—­æŒ‰é’® -->
      <view class="video-modal-close" bindtap="closeVideoModal">
        <text class="close-icon">Ã—</text>
      </view>
    </view>
  </view>
</view> 